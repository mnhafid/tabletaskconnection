<script>import { onMount, createEventDispatcher } from "svelte";
import collapse from "../scripts/collapse";
const dispatch = createEventDispatcher();
export let header;
export let options;
let collapsibleEl;
function toggle(e) {
  dispatch("BeforeTransition", { event: e, data: !options.open });
  options.open = !options.open;
}
onMount(() => {
  const mutationObserver = new MutationObserver((mutations) => mutated(mutations));
  mutationObserver.observe(collapsibleEl, { attributes: true });
  function mutated(mutations) {
    if (mutations.some((mutation) => mutation.attributeName === "data-transition_end")) {
      let transitionStatus = collapsibleEl.getAttribute("data-transition_end");
      dispatch("AfterTransition", { data: transitionStatus });
    }
  }
});
</script>

<div class="item">
    <button class="native header" class:collapsed={!options.open} on:click={(e) => toggle(e)}>
        {header}
        <i class="icon dropdown mascon-chevron-down"></i>
    </button>

    <div use:collapse={{ open: options.open }} bind:this={collapsibleEl}>
        <div class="content">
            <slot></slot>
        </div>
    </div>
</div>